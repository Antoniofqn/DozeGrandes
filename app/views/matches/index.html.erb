<h1>Escolha o confronto</h1>

<div class="container clubs">
    <% Club.all.each do |club| %>
      <%= cl_image_tag club.photo.key, height: 100, width: 100%>
    <% end  %>
</div>

<div class="container">
  <%= simple_form_for :search, url: root_path, method: "GET", html: { class: 'form-inline' } do |f| %>
    <%= f.input :home, input_html: {value: ""} %>
    <%= f.input :away, input_html: {value: ""} %>
    <%= f.input :competition, input_html: {value: ""} %>
    <%= f.input :stadium, input_html: {value: ""} %>
    <%= f.submit "Search", class: "btn btn-primary" %>
  <% end %>
</div>

<div class="container">
  <% if params['search'].present?  %>
    <% sum_home = 0  %>
    <% sum_away = 0  %>
    <% sum_empate = 0  %>
    <%= pie_chart @matches.group(:result).count %>
    <%= line_chart [
      { name: @home.name, data: @matches.where(result: @home.name).group_by_year(:date).count.map { |x,y| { x => (sum_home += y)} }.reduce({}, :merge), curve: false, points: false},
      { name: @away.name, data: @matches.where(result: @away.name).group_by_year(:date).count.map { |x,y| { x => (sum_away += y)} }.reduce({}, :merge), curve: false, points: false},
      { name: "Empate", data: @matches.where(result: "Empate").group_by_year(:date).count.map { |x,y| { x => (sum_empate += y)} }.reduce({}, :merge), curve: false, points: false}
    ] %>
  <% end %>
</div>

<div class="container">
  <table class="table table-bordered table-sm">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Data</th>
        <th scope="col">Mandante</th>
        <th scope="col">Resultado</th>
        <th scope="col">Visitante</th>
        <th scope="col">Estádio</th>
        <th scope="col">Competição</th>
      </tr>
    </thead>
      <% if params['search'].present? %>
        <% @matches.order('date desc').each do |match| %>
          <tr>
            <td scope="row"><%= match.date %></td>
            <td><%= match.home.name %></td>
            <td><%= match.score_home %> x <%= match.score_away %></td>
            <td><%= match.away.name %></td>
            <td><%= match.stadium %></td>
            <td><%= match.competition %></td>
          </tr>
        <% end %>
      <% end %>
  </table>
</div>

{ name: @home.name, data: @matches.where(result: @home.name).group(:id).count.map { |x,y| { x => (sum_home += y)} }.reduce({}, :merge)},

tooltips: { scales: { y: [{ ticks: { beginAtZero: true }}]}}
